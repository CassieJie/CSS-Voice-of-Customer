<!Doctype html>
<%- include ../public/header.ejs%>
<meta charset="utf-8">
<title>CSS Customer Voice| Add Case </title>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css" integrity="sha512-63+XcK3ZAZFBhAVZ4irKWe9eorFG0qYsy2CaM5Z+F3kUn76ukznN0cp4SArgItSbDFD1RrrWgVMBY9C/2ZoURA==" crossorigin="anonymous" />
<!--<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">-->
<link  href="../../../css/basic.css">
<link rel="icon" href="../../../images/mslogo.jpg">
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="//code.jquery.com/jquery-1.12.4.js"></script>
<!--<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js" integrity="sha512-GDey37RZAxFkpFeJorEUwNoIbkTwsyC736KNSYucu1WJWFK9qTdzYub8ATxktr6Dwke7nbFaioypzbDOQykoRg==" crossorigin="anonymous"></script>
<style>
    .panel-default > .panel-heading {
        color: white;
        background-color: #428bca;
        border-color: #ddd;
        opacity: 0.7;
    }
</style>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2">
            <%- include ../public/aslideleft.ejs%>
			
          
        </div>
        <div class="col-sm-10">
            <ol class="breadcrumb">
                <li class="active">CaseManagement
                </li>
                <li class="active">CaseList
                </li>
            </ol>
<!--  method1--file chosen        -->
            <div class="panel panel-default">

                <div class="panel-heading">
                    <b>Add Case / Email upload</b>
                </div>
                <form id="form"  enctype="multipart/form-data" style="margin:20px" >
                    <!--                <form action="/admin/product/uploadEmail" method="POST" enctype="multipart/form-data">-->
                    <div style="padding-left:25px">
                    <p><input type="file" name="thumbnail" style="margin:20px 0px;"></p>
                    <!--                    <p><input type="file" name="uploadImg" onchange="check_type(this)"></p>-->
                    <p><input type="button" value="submit" id="btn" class="btn btn-default" style="background: rgba(66,139,202,0.7);color: white"></p>
                    </div>
                </form>
            </div>
<!--  method2--form submit for case       -->
            <br>
            <div class="panel panel-default">
              
			    <div class="panel-heading">
                 <b>Add Case / Form submit</b>
                </div>
                <form id="form1"  action="##" method="post">
                            <ul>
                                <li>CaseID: <input style="margin-left: 9px" type="text" name="CaseID" id="CaseID"/></li>
<!--                                <span   style="color: red" class="iderror"></span>-->
                                <li>  Engineer: <input type="text" name="Engineer" id="Engineer"/></li>
                                <li>  Badge:
                                <label style="margin-left: 18px"><input name="Badge" type="checkbox" value="1" />Empathetic </label> <img src="../../upload/Empathetic.png" width="50px">
                                <label style="margin-left: 5px"><input name="Badge" type="checkbox" value="2" />High Quality</label><img src="../../upload/High Quality.png" width="50px" >
                                <label style="margin-left: 5px"><input name="Badge" type="checkbox" value="3" />Efficient </label><img src="../../upload/Efficient.png" width="50px" >
                                <label style="margin-left: 5px"><input name="Badge" type="checkbox" value="4" />Resourceful </label><img src="../../upload/Resourceful.png" width="50px">
                                <label style="margin-left: 5px"><input name="Badge" type="checkbox" value="5" />Communicate Effectively </label><img src="../../upload/Communicate Effectively.png" width="50px">
                                </li>
                                <li> Date:
                                    <input style="display: inline-block;width: 200px;margin-left: 27px" type="text" name="Date" id="Date" value="2020/02" required class="form-control" autocomplete="off"  >
                                </li>
                                <li>
                                    Voice:
                                    <textarea style="margin-left: 22px" name="CustomerVoice" id="Voice" cols="40" rows="4"></textarea>
                                </li>

                                <li>
                                    <br/>
                                    <button type="button" onclick ="" class="btn btn-default" style="background: rgba(66,139,202,0.7);color: white" id="button1">Submit</button>
                                </li>

                            </ul>

                                        </form>

            </div>
<!-- form submit for customer story       -->
<br>
<div class="panel panel-default">
  
    <div class="panel-heading">
     <b>Add Story / Form submit</b>
    </div>
    <form id="form0"  action="##" method="post">
                <ul>
                   <li>CaseID: <input style="margin-left: 9px" type="text" name="CaseID" id="SCaseID"/></li>
                    <form >
                    <input type="button" name="addtag" id="addTagbutt" value="Add story tag" onclick="addTag()"/>
                    </form>
                    <li>  Engineer:
                       <select name="SEngineer" id="SEngineer">
                       <%for(var i=0;i<list.length;i++){%>
                       <option value=<%=i%>><%=list[i]._id%></option>
                       
                       <%}%>
                       </select>
                    </li>
                    <li>  Badge:
                    <label style="margin-left: 18px"><input name="SBadge" type="checkbox" value="1" />Empathetic </label> <img src="../../upload/Empathetic.png" width="50px">
                    <label style="margin-left: 5px"><input name="SBadge" type="checkbox" value="2" />High Quality</label><img src="../../upload/High Quality.png" width="50px" >
                    <label style="margin-left: 5px"><input name="SBadge" type="checkbox" value="3" />Efficient </label><img src="../../upload/Efficient.png" width="50px" >
                    <label style="margin-left: 5px"><input name="SBadge" type="checkbox" value="4" />Resourceful </label><img src="../../upload/Resourceful.png" width="50px">
                    <label style="margin-left: 5px"><input name="SBadge" type="checkbox" value="5" />Communicate Effectively </label><img src="../../upload/Communicate Effectively.png" width="50px">
                    </li>
                    <li> Date:
                       <!-- <input style="display: inline-block;width: 200px;margin-left: 27px" type="text" name="weeklyDatePicker" id="weeklyDatePicker" required class="form-control" autocomplete="off"  > -->
                       <input type='text' style="display: inline-block;width: 200px;margin-left: 27px" id='weeklyDatePicker' placeholder="Select Week" />

                   </li>
                    <li>
                       Story:
                       <textarea style="margin-left: 22px" name="Story" id="Story" cols="40" rows="4"></textarea>
                   </li>
                    
                    <li>
                        Voice:
                        <textarea style="margin-left: 22px" name="SCustomerVoice" id="SVoice" cols="40" rows="4"></textarea>
                    </li>

                    <li>
                        <br/>
                        <button type="button" onclick ="" class="btn btn-default" style="background: rgba(66,139,202,0.7);color: white" id="Sbutton1">Submit</button>
                    </li>

                </ul>

            </form>
</div>  
    </div>

        </div>
    </div>
<script>
    let dateMonthConfig = {
        // language: "zh-CN", //����
        todayHighlight: true, //�Ƿ���ո���
        format: 'yyyy/mm', //����·ݺ���ʾ��input�еĸ�ʽ
        autoclose: true, //�Ƿ����Զ��ر�
        startView: 1, //��ʼ��ͼ�㣬Ϊ����ͼ��
        maxViewMode:'years', //�����ͼ�㣬Ϊ����ͼ��
        minViewMode:'months', //��С��ͼ�㣬Ϊ����ͼ��
        startDate:moment().subtract(360,'month').toDate(), //���ƿ�ѡ�������·ݣ�Ϊǰ12���£�����ǰ�£�
        endDate:moment().toDate(), //���ƿ�ѡ�������·ݣ�Ϊ��ǰ��
        clearBtn:true
    };

    // ������������
    $('#Date').datepicker(dateMonthConfig);
    console.log("dayin--"+$('#Date').val())
</script>
<script>
   
    $(document).ready(function(){
    moment.locale('en', {
      week: { dow: 1 } // Monday is the first day of the week
    });

  $("#weeklyDatePicker").datetimepicker({
     
  });

  $('#weeklyDatePicker').on('dp.change', function (e) {
      var value = $("#weeklyDatePicker").val();
      var firstDate = moment(value, "MM-DD-YYYY").day(1).format("MM-DD-YYYY");
      var lastDate =  moment(value, "MM-DD-YYYY").day(7).format("MM-DD-YYYY");
      $("#weeklyDatePicker").val(firstDate + " - " + lastDate);
    });
});
</script>
<!--����ϴ��ļ���׺-->
<script>
    $('#btn').click(function(){
        // ����formData�������������ݴ��
        var inpData = new FormData(document.getElementById('form'));
        $.ajax({
            url:'/admin/product/file',
            type:'post',
            contentType: false,
            data:inpData,// ��ɵ����ݰ�����ֱ��ͨ��send����
            processData:false,
            dataType:"text",
            error : function() {
                alert('parse failed ');
            },
            success : function(data) {
                alert(data);
            }
        })
        // alert('upload successfully!' );
    })
    // function check_type(obj){
    //     var str=$(obj).val();
    //     var index=str.lastIndexOf('.');
    //     var strtype=str.substr(index,4);
    //     strtype=strtype.toLowerCase();
    //     alert("strtype="+strtype);

    // if(strtype!=".png" || strtype!=".jpg" || strtype!=".gif"){
    //     $(obj).val("");
    //     alert("���ϴ�gif, jpg, png��ʽ��ͼƬ��");
    // }
</script>
<!--�����ύ����-->
<script>
    //������֤
    function check(caseID){   
        //�жϴ���������
        var isnum = /^SR\s\d{15}$/.test(caseID);
        //�жϷǿա����֡�����
        if( isnum==false){
            alert("Please input a correct caseID!(e.g. SR 120020423000164)");
            return false;
        }
        return true;
    }

    //�ύ��������̨
    $('#button1').click(function(){
        var checkID = [];//����һ��������
        obj = document.getElementById("Badge")

        $("input[name='Badge']:checked").each(function(i){//�����б�ѡ�еĸ�ѡ���ֵ��������
            checkID[i] =$(this).val();
        });

        var  para1 = $('#CaseID').val();
        var  para2 = $('#Engineer').val();
        var  para3 = $('#Date').val();
        var map = {"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep","10":"Oct","11":"Nov","12":"Dec"};
        var l =map[para3.split('/')[1]];
        para3 =l+" "+para3.split('/')[0];
        var  para4 = JSON.stringify(checkID);
        var  para5 = $('#Voice').val();

        //��Ajax���ݲ���
        var caseID = $("#CaseID").val();
        var result = check(caseID);

        if (result == true) {

            $.post('/admin/product/doAdd', {
                CaseID: para1,
                Engineer: para2,
                Date: para3,
                checkID: para4,
                Voice: para5
            }, function (data) {
                if(data.repeat == 'yes'){
                    alert("CaseID already exists!")
                }else if (data.result == 'success'){
                    alert('Add case successful!');
                    location.reload;
                } else {
                    alert("Add case error!")
                }
            })
        }
    })
    function addTag(){
        var txt = document.createElement("input");
        txt.type = "text";
        txt.name = "txt";
        txt.value = "#";
        $('#addTagbutt').after(txt);
    }

    $('#Sbutton1').click(function(){
        var checkID = [];//����һ��������
        var tag = [];
        obj = document.getElementById("SBadge")
        
        $("input[name='SBadge']:checked").each(function(i){
            checkID[i] =$(this).val();
        });
        $("input[name='txt']").each(function(i){
            tag[i] =$(this).val();
        });
        
        var  para0 = $('#CaseID').val();
   
        var  para1 = JSON.stringify(tag);
        console.log(tag);
        var  para2 = $("select[name='SEngineer'] option:selected").text();
        var  para3 = $('#weeklyDatePicker').val();
        console.log("!!!para3-----"+para3);
        // var map = {"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep","10":"Oct","11":"Nov","12":"Dec"};
        // var l =map[para3.split('/')[1]];
        // para3 =l+" "+para3.split('/')[0];
        // console.log("sdate--"+para3);
        var  para4 = JSON.stringify(checkID);
        var  para5 = $('#SVoice').val();
        var  para6 = $('#Story').val();

        //��Ajax���ݲ���
        var scaseID = $("#SCaseID").val();
        var result = check(scaseID);
        if (result == true) {

            $.post('/admin/product/addStory', {
                CaseID:para0,
                Tag: para1,
                Engineer: para2,
                Date: para3,
                Badge: para4,
                Voice: para5,
                Story: para6
            }, function (data) {
                if(data.repeat == 'yes'){
                    alert("Story already exists!");
                }else if (data.result == 'success'){
                    alert('Add Story successful!');
                    $("#form0")[0].reset();
                } else {
                    alert("Add Story error!")
                }
            })
        }
    })
</script>
</body>
</html>